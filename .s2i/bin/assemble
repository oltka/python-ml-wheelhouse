#!/bin/bash

set -eo pipefail
echo " -----> Upgrading Python packaging tools."
pip install -U pip setuptools wheel

echo " -----> Current working directory: $(pwd)"
echo " -----> Making /opt/app-root/cache for incremental build"
mkdir -p /opt/app-root/cache

REQUIREMENTS_FILE="${REQUIREMENTS_FILE:-/tmp/src/requirements.txt}"

echo " -----> Requirement file: $REQUIREMENTS_FILE"

if [ -f "$REQUIREMENTS_FILE" ]; then
    echo " -----> Installing Python packages from $REQUIREMENTS_FILE file..."
    echo " ------------------------------------------------------------------"
    cat $REQUIREMENTS_FILE
    echo " ------------------------------------------------------------------"
    
    echo " -----> Processing requirements file: $REQUIREMENTS_FILE"
    pip download -d /opt/app-root/cache -r $REQUIREMENTS_FILE
else
    echo " -----> Skipping requirements file: $REQUIREMENTS_FILE"
fi

echo " -----> Done."
